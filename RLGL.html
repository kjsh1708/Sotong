<!-- 1. High lvl concept: Screen is green, doll facing away; Doll face you, screen red, have 0.5s to react

2. Implementation
    a. Create a green background screen and 2 divisions to show start, palying field and end (flow from bottom of screen upwards)
        1. Start and end points should take up 10% of the page each 
        2. Playing field: 80% of the page 
    b. Allow user to clickm, while holding click down, object moves, when he lets go object stops moving
    c. If user moving and screen red + doll facing him (0.5s delay), lose | else carry on living
    d. If user crosses finish line (win) and can move on to the next game (maybe have a win / loss counter?)
    e. alert (loss), lose counter ++? | alert (win), continue on to the next game  -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Bootstrap -->
    <!-- CSS only -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link href="./RLGL.css" rel="stylesheet" type="text/css" />
    <title>Red Light Green Light</title>
    <link rel="shortcut icon" href="./rlgl_images/rlgl.ico" />
    <!-- JavaScript Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>


  </head>
  <body onkeydown="getKeyAndMove(event)" style="position: relative">
    <!-- Start, PF, End -->
    <div class="container-fluid">
      <!-- Header Nav -->
      <div id="headerNav" class="row bg-light">
        <img id="header_img" src="./rlgl_images/pgName.png" alt="Red light Green light" />
      </div>
      <!-- end point -->
      <div id="end" class="row bg-warning bg-opacity-75">end</div>
      <!-- playing field -->
      <div id="pf" class=" row bg-success bg-opacity-75">playing field</div>
      <!-- start point -->
      <div id="start" class=" row bg-warning bg-opacity-75">start pt
      </div>

          <!-- Character Model -->
      <img  id="image1" src="./rlgl_images/067.png" alt="067 player" />
    </div>
  
  </body>

  <script>
const playingfield = document.getElementById("pf");
var deaths = 0;
var 
//lose condition
function cannot_move(){
 alert("lose!");
 // init , gamestart, deaths + 1
}
// can move
function can_move(){
  playingfield.removeEventListener('click',cannot_move);
}

    //Function to change color of page -- basically change the class every few s

    function redlight() {
      playingfield.classList.replace("bg-success", "bg-danger");
      playingfield.addEventListener('click',cannot_move);
    }
    function greenlight() {
      //remove the move_param event
      playingfield.addEventListener('click',can_move());
      playingfield.classList.replace("bg-danger", "bg-success");
      //start music
      var green_music = new Audio(
        "./rlgl_sound/SQUID_GAME_GREEN_RED_LIGHT.mp3"
      );
      green_music.play();
      //change to redlight 
      green_music.onended = redlight;
      // do not allow user to start game again by clicking 
      let after_start = document.removeEventListener('click', greenlight);
      
    }
    function change_light(){
      if(playingfield.classList.contains("bg-danger")) {
        // move_param('green');
        greenlight();
        
        
      }
      else if(playingfield.classList.contains("bg-success")){
        // move_param('red');
        redlight();
        
      }
    }

    
    function game_start(){
      //after sound ends, run redlight() for 5s then call green light again
      // sound file is 8s long but 2s reaction time
      var start = document.addEventListener('click', greenlight);
      
      // need to figure out how to change light every x seconds after the music ends 
      window.setInterval(change_light,15000);
    
    }
    game_start();
    


    //Moving char across screen
    //init object globally
    var objImage = null;
        function init() {
          //Change the position of the object to be at the bottom of the page
          objImage = document.getElementById("image1");
          objImage.style.position = "absolute";
          objImage.style.left = "0px";
          objImage.style.bottom = "10px";
          //coordinates
               //if current position < clientHeight*0.2 = win?
        //current position of the element
  
        }
        function getKeyAndMove(e) {
          var key_code = e.which || e.keyCode;
          switch (key_code) {
            case 37: //left arrow key
              moveLeft();
              break;
            case 38: //Up arrow key
              moveUp();
              break;
            case 39: //right arrow key
              moveRight();
              break;
            // case 40: //down arrow key
            //   moveDown();
            //   break;
          }
        }
        function moveLeft() {
          objImage.style.left = parseInt(objImage.style.left) - 5 + "px";
        }
        // lowered this so that it can match sound track
        function moveUp() {
          objImage.style.bottom = parseInt(objImage.style.bottom) + 1 + "px";
        }
        function moveRight() {
          objImage.style.left = parseInt(objImage.style.left) + 5 + "px";
        }
        // function moveDown() {
        //   objImage.style.bottom = parseInt(objImage.style.bottom) - 5 + "px";
        
        // }
  
        //Now is the tracking of the object on where it is on the screen
        //Find the finish line using the vh of the client
        let pf_end = document.documentElement.clientHeight*0.2;
        let pf_start = document.documentElement.clientHeight*0.9;
        let pf_area = document.elementFromPoint(pf_end,pf_start);
        console.log(pf_end);
  
        //function to get current position of the element
        document.addEventListener("keyup",logPos);
        function logPos() {
          var player = document.getElementById("image1");
          var pos = player.getBoundingClientRect();
          var pos_y = pos.top;
          console.log(pos_y);
          if(pos_y< pf_end){
            alert("winner!");
          }
        }
  
        window.onload = init;
  

  </script>
</html>
