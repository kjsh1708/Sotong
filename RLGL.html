<!-- 1. High lvl concept: Screen is green, doll facing away; Doll face you, screen red, have 0.5s to react

2. Implementation
    a. Create a green background screen and 2 divisions to show start, palying field and end (flow from bottom of screen upwards)
        1. Start and end points should take up 10% of the page each 
        2. Playing field: 80% of the page 
    b. Allow user to clickm, while holding click down, object moves, when he lets go object stops moving
    c. If user moving and screen red + doll facing him (0.5s delay), lose | else carry on living
    d. If user crosses finish line (win) and can move on to the next game (maybe have a win / loss counter?)
    e. alert (loss), lose counter ++? | alert (win), continue on to the next game  -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link href="./RLGL.css" rel="stylesheet" type="text/css" />
    <title>Red Light Green Light</title>
    <link rel="shortcut icon" href="./rlgl_images/rlgl.ico" />
    <!-- JavaScript Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>

    <!-- axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  </head>
  <!-- change the event to on mouse down -->
  <body onmousedown="mouseDownMove()" style="position: relative">
    <!-- Start, PF, End -->
    <div class="container-fluid">
      <!-- Header Nav -->
      <div id="headerNav" class="row bg-light">
        <img
          id="header_img"
          src="./rlgl_images/pgName.png"
          alt="Red light Green light"
        />
      </div>
      <!-- end point -->
      <div id="end" class="row bg-warning bg-opacity-75">end</div>
      <!-- playing field -->
      <div id="pf" class="row bg-success bg-opacity-75">playing field</div>
      <!-- start point -->
      <div id="start" class="row bg-warning bg-opacity-75">start pt</div>

      <!-- Character Model -->
      <img id="image1" src="./rlgl_images/067.png" alt="067 player" />
    </div>
  </body>

  <script>
    //save results to php file using axios
 
    // Timer to be implemented

    //Define vars to hold time values
    var minutes = 0;
    var seconds = 0;

    //Define var to hold setInterval() function
    let interval = null;

    //Stopwatch function (logic to determine when to increment next value, etc.)
    function stopWatch() {
      seconds++;

      //Logic to determine when to increment next value
      if (seconds / 60 === 1) {
        seconds = 0;
        minutes++;
      }
    }

    function start_time() {
      //Start the stopwatch (by calling the setInterval() function)
      interval = window.setInterval(stopWatch, 1000);
    }

    function stop_time() {
      window.clearInterval(interval);
      //get these values -- lowerr the highscore better == faster
      var highscore = minutes * 60 + seconds;
      return highscore;
    }

    //Function to reset the stopwatch
    function reset_time() {
      window.clearInterval(interval);
      seconds = 0;
      minutes = 0;
    }
    const playingfield = document.getElementById("pf");
    //lose condition
    function cannot_move() {
      alert("lose!");
      //clear stopwatch
      reset_time();
      //reload the page
      location.reload();
    }
    // can move
    function can_move() {
      document.removeEventListener("click", cannot_move);
    }

    //Function to change color of page -- basically change the class every few s

    function redlight() {
      playingfield.classList.replace("bg-success", "bg-danger");
      document.addEventListener("click", cannot_move);
    }
    function greenlight() {
      // attach this to the document itself instead of just pf
      document.addEventListener("click", can_move());
      playingfield.classList.replace("bg-danger", "bg-success");
      //start music
      var green_music = new Audio(
        "./rlgl_sound/SQUID_GAME_GREEN_RED_LIGHT.mp3"
      );
      green_music.play();
      //change to redlight
      green_music.onended = redlight;
      // do not allow user to start game again by clicking
      let after_start = document.removeEventListener("click", greenlight);
    }
    function change_light() {
      if (playingfield.classList.contains("bg-danger")) {
        greenlight();
      } else if (playingfield.classList.contains("bg-success")) {
        redlight();
      }
    }

    function game_start() {
      //start the game on greenlight
      var start = document.addEventListener("click", greenlight);

      // need to figure out how to change light every x seconds after the music ends (maybe use a set time out instead)?
      window.setInterval(change_light, 15000);

      //start the stopwatch
      start_time();
    
    }
    game_start();

    //Moving char across screen
    //init object globally
    var objImage = null;
    function init() {
      //Change the position of the object to be at the bottom of the page
      objImage = document.getElementById("image1");
      objImage.style.position = "absolute";
      objImage.style.left = "50%";
      objImage.style.bottom = "10px";
    }
    // change this to onclick
    function mouseDownMove() {
      moveUp();
    }
    // lowered this so that it can match sound track
    function moveUp() {
      // how ,uch the character moves up by
      objImage.style.bottom = parseInt(objImage.style.bottom) + 100 + "px";
    }

    //Now is the tracking of the object on where it is on the screen
    //Find the finish line using the vh of the client
    let pf_end = document.documentElement.clientHeight * 0.2;
    let pf_start = document.documentElement.clientHeight * 0.9;
    let pf_area = document.elementFromPoint(pf_end, pf_start);
    console.log(pf_end);

    //function to get current position of the element
    document.addEventListener("mouseup", logPos);
    function logPos() {
      var player = document.getElementById("image1");
      var pos = player.getBoundingClientRect();
      // this pos need to + the height of my char model
      var pos_y = parseInt(pos.top) + 50;
      console.log(pos_y);
      if (pos_y < pf_end) {
        let stop_move1 = document.removeEventListener("click", can_move());
        let stop_move2 = document.removeEventListener("click", cannot_move);
        //stop stopwatch
        stop_time();
        var HS = stop_time();
        // console.log(stop_time());
        //remove the ability to move and not move
       
        //change this to a prompt box and input will be name , time is auto saved
        var HSname = prompt("You won! What is your name, Player?");
        // Validation to ensure that user enters only alpha num
        var regEx = /^[0-9a-zA-Z]+$/;
        if (HSname.match(regEx)) {
          //submit name and other data via axios
          submitDetails(HS,HSname);
          console.log(HS,HSname);
          //Chage this to redirect to PHP page which will save info to DB
          // window.location.href = "./RLGLResults.html";
        } else {
          alert("Please enter letters and numbers only.");
          var HSname = "";
          prompt("What is your name, Player?");
        }
      }
    }
    function submitDetails(a,b) {
      axios.post('./response.php', {
    Highscore: a,
    playerName: b
  })
  .then(function (response) {
    console.log(response);
  })
  .catch(function (error) {
    console.log(error);
  });
    }
    window.onload = init;
  </script>

</html>
